<%- layout('layouts/boilerplate') -%>

    <div id="clusterMap"></div>

    <h1>All Buffets</h1>

    <div>
        <a href="/buffets/new">Add Buffet</a>
    </div>


    <% buffets.forEach((buffet)=> { %>

        <div class="card mb-3">
            <div class="row">
                <div class="col-md-4">
                    <% if (buffet.images.length) { %>
                        <img class="img-fluid" src="<%= buffet.images[0].url %>" alt="">
                        <% } else { %>
                            <img class="img-fluid" src="https://res.cloudinary.com/dh9isfyyf/image/upload/v1685032691/Wok%20This%20Way%20-%20Default%20Images/wok.cover_ucisey.jpg"
                                alt="">
                            <% } %>
                </div>

                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">
                            <%= buffet.title %>
                        </h5>

                        <p class="card-text">
                            <%= buffet.description %>
                        </p>

                        <p class="card-text text-secondary fw-bold">
                            <small>
                                <%= buffet.location %>
                            </small>
                        </p>

                        <p>
                            <a class="btn btn-primary" href="/buffets/<%= buffet._id %>">View <%= buffet.title %></a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    <% }) %>

    <script>

        const mapboxToken = '<%-process.env.MAPBOX_TOKEN%>'
        const buffets = {features: <%- JSON.stringify(buffets) %>}

    </script>

    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" crossorigin>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js" crossorigin></script>

    <script src="/js/clusterMap.js"></script>